Version 4
SHEET 1 1760 1176
WIRE 1424 -480 -832 -480
WIRE 144 -416 -432 -416
WIRE 592 -416 208 -416
WIRE -832 -352 -832 -480
WIRE -688 -352 -832 -352
WIRE -512 -352 -608 -352
WIRE -832 -144 -832 -352
WIRE -672 -144 -832 -144
WIRE -432 -144 -432 -416
WIRE -432 -144 -592 -144
WIRE -368 -144 -432 -144
WIRE -208 -144 -288 -144
WIRE -160 -144 -208 -144
WIRE -48 -144 -160 -144
WIRE 160 -144 -48 -144
WIRE 336 -144 224 -144
WIRE 496 -144 336 -144
WIRE 592 -144 592 -416
WIRE 592 -144 496 -144
WIRE 1024 -144 592 -144
WIRE 1424 -144 1424 -480
WIRE 1424 -144 1088 -144
WIRE 592 -96 592 -144
WIRE 336 -64 336 -144
WIRE 336 -64 32 -64
WIRE 192 32 128 32
WIRE 240 32 192 32
WIRE 32 80 32 -64
WIRE 64 80 32 80
WIRE 32 96 32 80
WIRE 128 96 128 32
WIRE 64 112 64 80
WIRE 80 112 64 112
WIRE -736 128 -832 128
WIRE -624 128 -736 128
WIRE -528 128 -624 128
WIRE -432 128 -528 128
WIRE 480 128 336 128
WIRE 592 128 592 -16
WIRE 592 128 480 128
WIRE 624 128 592 128
WIRE 720 128 688 128
WIRE 800 128 720 128
WIRE 832 128 800 128
WIRE 864 128 832 128
WIRE 80 160 64 160
WIRE 336 176 336 128
WIRE 32 192 32 176
WIRE 64 192 64 160
WIRE 64 192 32 192
WIRE 864 208 864 128
WIRE 976 208 864 208
WIRE 1088 208 976 208
WIRE 1248 208 1088 208
WIRE -832 224 -832 128
WIRE -736 224 -736 128
WIRE -624 224 -624 128
WIRE -432 224 -432 128
WIRE 976 240 976 208
WIRE 1088 240 1088 208
WIRE 1248 240 1248 208
WIRE 240 256 240 32
WIRE 288 256 240 256
WIRE -48 288 -48 -144
WIRE 64 288 -48 288
WIRE -48 304 -48 288
WIRE 128 304 128 176
WIRE -432 320 -432 304
WIRE -208 320 -208 -144
WIRE -208 320 -432 320
WIRE 64 320 64 288
WIRE 80 320 64 320
WIRE 336 320 336 272
WIRE 496 320 336 320
WIRE 624 320 496 320
WIRE -624 336 -624 304
WIRE -544 336 -624 336
WIRE -512 336 -544 336
WIRE 720 336 720 128
WIRE 800 336 800 128
WIRE -624 352 -624 336
WIRE -432 352 -432 320
WIRE 80 368 64 368
WIRE 1088 368 1088 320
WIRE 1248 368 1248 320
WIRE 1168 384 1136 384
WIRE 1328 384 1296 384
WIRE -48 400 -48 384
WIRE 32 400 32 192
WIRE 32 400 -48 400
WIRE 64 400 64 368
WIRE 64 400 32 400
WIRE 240 400 240 256
WIRE -832 432 -832 304
WIRE -784 432 -832 432
WIRE -736 432 -736 288
WIRE -736 432 -784 432
WIRE -672 432 -736 432
WIRE -512 432 -512 336
WIRE -480 432 -512 432
WIRE 1168 432 1136 432
WIRE 1328 432 1296 432
WIRE 128 448 128 384
WIRE 1136 448 1136 432
WIRE 1296 448 1296 432
WIRE -832 480 -832 432
WIRE 976 544 976 320
WIRE 976 544 864 544
WIRE 1088 544 1088 448
WIRE 1088 544 976 544
WIRE 1136 544 1136 528
WIRE 1136 544 1088 544
WIRE 1248 544 1248 448
WIRE 1248 544 1136 544
WIRE 1296 544 1296 528
WIRE 1296 544 1248 544
WIRE -48 576 -48 400
WIRE 128 576 128 528
WIRE 128 576 -48 576
WIRE 240 576 240 480
WIRE 240 576 128 576
WIRE 336 576 336 320
WIRE 336 576 240 576
WIRE -832 624 -832 560
WIRE -624 624 -624 448
WIRE -432 624 -432 448
WIRE 624 624 624 320
WIRE 720 624 720 400
WIRE 800 624 800 400
WIRE 864 624 864 544
FLAG 496 -144 2_Vbat
FLAG 480 128 4_VL
FLAG -160 -144 1_Vsol
FLAG 496 320 3_Vgnd
FLAG 720 624 0
FLAG 800 624 0
FLAG 832 128 Vcc
FLAG 864 624 0
FLAG 624 624 0
FLAG -432 624 0
FLAG -624 624 0
FLAG -832 624 0
FLAG -528 128 Vcc
FLAG -784 432 Vg1
FLAG -544 336 Vg2
FLAG 192 32 Vg3
FLAG -512 -352 0
FLAG 1168 384 0
FLAG 1328 384 0
FLAG 1168 432 V3
FLAG 1328 432 V5
SYMBOL ind 576 -112 R0
SYMATTR InstName L1
SYMATTR Value 33µ
SYMATTR SpiceLine Rser=0.01
SYMBOL nmos 288 176 R0
WINDOW 3 -5 -73 Left 2
SYMATTR Value 2N7002
SYMATTR InstName M1
SYMBOL voltage 128 432 R0
WINDOW 3 -149 178 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PULSE(0 5 0 0.1u 0.1u 5u 10u)
SYMATTR InstName V1
SYMBOL sw 128 400 M180
WINDOW 0 40 58 Left 2
WINDOW 3 -4 105 Left 2
SYMATTR InstName S1
SYMATTR Value SOL_SW
SYMBOL res 224 384 R0
SYMATTR InstName R1
SYMATTR Value 1k
SYMBOL schottky 160 -128 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMATTR Value BAT46WJ
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL res -64 288 R0
SYMATTR InstName R2
SYMATTR Value 30k
SYMBOL schottky 624 144 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D2
SYMATTR Value BAT46WJ
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL polcap 704 336 R0
WINDOW 3 24 56 Left 2
SYMATTR Value 220µ
SYMATTR InstName C1
SYMATTR Description Capacitor
SYMATTR Type cap
SYMATTR SpiceLine V=4 Irms=3.72678 Rser=0.018 Lser=0 mfg="KEMET" pn="A700D107M004ATE018" type="Al electrolytic"
SYMBOL cap 784 336 R0
SYMATTR InstName C2
SYMATTR Value 0.1µ
SYMATTR SpiceLine V=16 Irms=4.39 Rser=0.0357547 Lser=0 mfg="KEMET" pn="C0402C104K4RAC" type="X7R"
SYMBOL voltage -576 -144 R90
WINDOW 0 -32 56 VBottom 2
WINDOW 3 32 56 VTop 2
WINDOW 123 0 0 Left 0
WINDOW 39 94 57 VBottom 2
SYMATTR InstName V2
SYMATTR Value 2.4V
SYMATTR SpiceLine Rser={X}
SYMBOL Misc\\cell 1024 -144 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 -32 32 VBottom 2
WINDOW 123 0 0 Left 0
WINDOW 39 -94 34 VTop 2
SYMATTR InstName V4
SYMATTR Value 1.25V
SYMATTR SpiceLine Rser={Y}
SYMBOL res 960 224 R0
SYMATTR InstName R3
SYMATTR Value {Rs}
SYMBOL res -448 208 R0
SYMATTR InstName R4
SYMATTR Value 220k
SYMBOL res -640 208 R0
SYMATTR InstName R5
SYMATTR Value 470k
SYMBOL res -848 208 R0
SYMATTR InstName R6
SYMATTR Value 1Meg
SYMBOL res -848 464 R0
SYMATTR InstName R7
SYMATTR Value 550k
SYMBOL 2N7000 -672 352 R0
SYMATTR InstName U1
SYMBOL 2N7000 -480 352 R0
SYMATTR InstName U2
SYMBOL cap -752 224 R0
SYMATTR InstName C3
SYMATTR Value 150p
SYMBOL sw 128 192 M180
WINDOW 0 41 57 Left 2
WINDOW 3 -50 106 Left 2
SYMATTR InstName S2
SYMATTR Value LOWBAT_SW
SYMBOL res 48 80 M0
SYMATTR InstName R8
SYMATTR Value 70k
SYMBOL res -272 -160 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 54 52 VTop 2
SYMATTR InstName R9
SYMATTR Value {TEST_SW}
SYMBOL schottky 144 -400 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D3
SYMATTR Value BAT46WJ
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL res -592 -368 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 60 49 VTop 2
SYMATTR InstName R10
SYMATTR Value {MAN_PWR_SW}
SYMBOL res 1072 224 R0
SYMATTR InstName R11
SYMATTR Value {Rg}
SYMBOL sw 1088 352 M0
WINDOW 0 -70 56 Left 2
WINDOW 3 -62 -2 Left 2
SYMATTR InstName S3
SYMATTR Value GLOW_SW
SYMBOL voltage 1136 432 R0
WINDOW 0 36 50 Left 2
WINDOW 3 -197 131 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value PWL(0 0 200m 0 +1u 1 +40m 1 +1u 0)
SYMBOL res 1232 224 R0
SYMATTR InstName R12
SYMATTR Value {Ra}
SYMBOL sw 1248 352 M0
WINDOW 0 -68 56 Left 2
WINDOW 3 -80 -1 Left 2
SYMATTR InstName S4
SYMATTR Value ACTION_SW
SYMBOL voltage 1296 432 R0
WINDOW 0 35 51 Left 2
WINDOW 3 -333 163 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value PWL(0 0 90m 0 +1u 1 +40m 1 +1u 0)
TEXT -360 856 Left 2 !.model        SOL_SW SW(Ron=10Meg Roff=1 Vt=0.286V Vh=0.04V
TEXT 32 -224 Left 4 ;QX5252 Solar IC
TEXT -800 704 Left 4 !.tran 0 300m uic
TEXT -360 744 Left 2 !.param X 50
TEXT 968 -224 Left 4 ;NiMH Akku
TEXT -712 -224 Left 4 ;Solarcell
TEXT 1096 160 Left 4 ;ATtiny85
TEXT -800 744 Left 4 !.ic V(Vcc)=0
TEXT -360 880 Left 2 !.model LOWBAT_SW SW(Ron=1 Roff=10Meg Vt=0.9V Vh= 0.01V)
TEXT 1000 -32 Left 2 ;Rser=0.2(full)....5(empty)
TEXT -688 -32 Left 2 ;Rser=50(sun)....240k(bluehour)
TEXT -192 744 Left 2 !.param Y 0.2
TEXT -24 744 Left 2 !.param Rs 750k
TEXT 240 776 Left 2 ;R=**100...*450(fullpower)...*750k(powerdown+WDT) at Vcc=**2.2V or *4.5V
TEXT 696 -272 Left 2 ;I(V4)=200uA(powerdown+WDT)...54mA(fullpower)
TEXT -360 696 Left 2 !.param MAN_PWR_SW 1m
TEXT -24 696 Left 2 !.param TEST_SW 1G
TEXT -688 -672 Left 3 ;spice model of QX5252 solar DCDC converter with simple but effective voltage regulator. Ripple on Vcc is about 4mV.\nTEST_SW should be off (1G). If on (1m) you switch to the older less effective design (U2 shorts the solar cell 50%). There D3 is useless.                       \n     R3 is the static representation of the ATtiny MCU in sleep mode. R11 and R12  represents dynamic loads (LED::glow and LED::on)\n                           MAN_PWR_SW is really on board and for selection of charge only mode vs. charge and action mode.
TEXT -160 -352 Left 2 ;discharge protection diode (works like D1 but in new design)
TEXT -808 72 Left 4 ;Error Amp
TEXT -24 776 Left 2 !.param Rg 50k
TEXT -24 808 Left 2 !.param Ra 450
TEXT 552 848 Left 2 !.model    GLOW_SW SW(Ron=1 Roff=10Meg Vt=0.5V Vh= 0.01V)
TEXT 552 872 Left 2 !.model ACTION_SW SW(Ron=1 Roff=10Meg Vt=0.5V Vh= 0.01V)
TEXT -8 928 Left 2 ;file dependencies: need 2N7000.asy and 2N7000.lib in same directory
TEXT 256 960 Left 2 ;25mmHg 23.5.2021
LINE Normal 192 720 144 720
LINE Normal 192 832 192 720
LINE Normal 144 832 192 832
LINE Normal 224 784 192 784
RECTANGLE Normal 432 656 -96 -272 3
RECTANGLE Normal 1440 656 928 96 3
